/**
 * ByteBuffer v1.0.1
 * Copyright (c) 2012-2014 Tim Kurvers <http://moonsphere.net>
 *
 * Wrapper for ArrayBuffer/DataView maintaining index and default endianness.
 * Supports arbitrary reading/writing, implicit growth, clipping, cloning and
 * reversing as well as UTF-8 characters and NULL-terminated C-strings.
 *
 * The contents of this file are subject to the MIT License, under which
 * this library is licensed. See the LICENSE file for the full license.
 */

var ByteBuffer;ByteBuffer=function(){function a(a,c,d){var f;null==a&&(a=0),null==c&&(c=e.BIG_ENDIAN),null==d&&(d=!1),this._buffer=null,this._raw=null,this._view=null,this._order=!!c,this._implicitGrowth=!!d,this._index=0,f=b(a,!0),f||(f=new ArrayBuffer(a)),this.buffer=f}var b,c,d,e,f,g;return a.LITTLE_ENDIAN=!0,a.BIG_ENDIAN=!1,e=a,c=function(b){var c,d,e;e=[];for(d in b)c=b[d],e.push(Object.defineProperty(a.prototype,d,{get:c,enumerable:!0,configurable:!0}));return e},f=function(b){var c,d,e;e=[];for(c in b)d=b[c],e.push(Object.defineProperty(a.prototype,c,{set:d,enumerable:!0,configurable:!0}));return e},a.prototype._sanitizeIndex=function(){return this._index<0&&(this._index=0),this._index>this.length?this._index=this.length:void 0},b=function(a,b){var c;if(null==b&&(b=!1),null!=a.byteLength)return null!=a.buffer?b?a.buffer.slice(0):a.buffer:b?a.slice(0):a;if(null==a.length)return null;if(a.constructor===String)return null;try{return new Uint8Array(a).buffer}catch(d){return c=d,null}},c({buffer:function(){return this._buffer}}),f({buffer:function(a){return this._buffer=a,this._raw=new Uint8Array(this._buffer),this._view=new DataView(this._buffer),this._sanitizeIndex()}}),c({raw:function(){return this._raw}}),c({view:function(){return this._view}}),c({length:function(){return this._buffer.byteLength}}),c({byteLength:function(){return this.length}}),c({order:function(){return this._order}}),f({order:function(a){return this._order=!!a}}),c({implicitGrowth:function(){return this._implicitGrowth}}),f({implicitGrowth:function(a){return this._implicitGrowth=!!a}}),c({index:function(){return this._index}}),f({index:function(a){if(0>a||a>this.length)throw new RangeError("Invalid index "+a+", should be between 0 and "+this.length);return this._index=a}}),a.prototype.front=function(){return this._index=0,this},a.prototype.end=function(){return this._index=this.length,this},a.prototype.seek=function(a){return null==a&&(a=1),this.index+=a,this},c({available:function(){return this.length-this._index}}),d=function(a,b){return function(c){var d;if(null==c&&(c=this._order),b>this.available)throw new Error("Cannot read "+b+" byte(s), "+this.available+" available");return d=this._view[a](this._index,c),this._index+=b,d}},g=function(a,b){return function(c,d){var e;if(null==d&&(d=this._order),e=this.available,b>e){if(!this._implicitGrowth)throw new Error("Cannot write "+c+" using "+b+" byte(s), "+e+" available");this.append(b-e)}return this._view[a](this._index,c,d),this._index+=b,this}},a.prototype.readByte=d("getInt8",1),a.prototype.readUnsignedByte=d("getUint8",1),a.prototype.readShort=d("getInt16",2),a.prototype.readUnsignedShort=d("getUint16",2),a.prototype.readInt=d("getInt32",4),a.prototype.readUnsignedInt=d("getUint32",4),a.prototype.readFloat=d("getFloat32",4),a.prototype.readDouble=d("getFloat64",8),a.prototype.writeByte=g("setInt8",1),a.prototype.writeUnsignedByte=g("setUint8",1),a.prototype.writeShort=g("setInt16",2),a.prototype.writeUnsignedShort=g("setUint16",2),a.prototype.writeInt=g("setInt32",4),a.prototype.writeUnsignedInt=g("setUint32",4),a.prototype.writeFloat=g("setFloat32",4),a.prototype.writeDouble=g("setFloat64",8),a.prototype.read=function(a){var b;if(null==a&&(a=this.available),a>this.available)throw new Error("Cannot read "+a+" byte(s), "+this.available+" available");if(0>=a)throw new RangeError("Invalid number of bytes "+a);return b=new e(this._buffer.slice(this._index,this._index+a),this.order),this._index+=a,b},a.prototype.write=function(a){var c,d,e;if(a instanceof Uint8Array)e=a;else{if(d=b(a),!d)throw new TypeError("Cannot write "+a+", not a sequence");e=new Uint8Array(d)}if(c=this.available,e.byteLength>c){if(!this._implicitGrowth)throw new Error("Cannot write "+a+" using "+e.byteLength+" byte(s), "+this.available+" available");this.append(e.byteLength-c)}return this._raw.set(e,this._index),this._index+=e.byteLength,this},a.prototype.readString=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(null==a&&(a=this.available),a>this.available)throw new Error("Cannot read "+a+" byte(s), "+this.available+" available");if(0>=a)throw new RangeError("Invalid number of bytes "+a);for(m=this._raw,h=[],f=0,b=c=d=e=null,n=this._index+a;this._index<n;)if(b=m[this._index],128>b)h[f++]=b,this._index++;else{if(194>b)throw new Error("Unexpected continuation byte");if(224>b){if(c=m[this._index+1],128>c||c>191)throw new Error("Bad continuation byte");h[f++]=((31&b)<<6)+(63&c),this._index+=2}else if(240>b){if(c=m[this._index+1],128>c||c>191)throw new Error("Bad continuation byte");if(d=m[this._index+2],128>d||d>191)throw new Error("Bad continuation byte");h[f++]=((15&b)<<12)+((63&c)<<6)+(63&d),this._index+=3}else{if(!(245>b))throw new Error("Illegal byte");if(c=m[this._index+1],128>c||c>191)throw new Error("Bad continuation byte");if(d=m[this._index+2],128>d||d>191)throw new Error("Bad continuation byte");if(e=m[this._index+3],128>e||e>191)throw new Error("Bad continuation byte");i=((7&b)<<18)+((63&c)<<12)+((63&d)<<6)+(63&e),i-=65536,h[f++]=55296+((1047552&i)>>>10),h[f++]=56320+(1023&i),this._index+=4}}if(l=65536,k=h.length,l>k)return String.fromCharCode.apply(String,h);for(g=[],j=0;k>j;)g.push(String.fromCharCode.apply(String,h.slice(j,j+l))),j+=l;return g.join("")},a.prototype.writeString=function(a){var b,c,d,e,f,g,h;for(c=[],h=a.length,g=0,b=0;h>g;){if(d=a.charCodeAt(g),127>=d)c[b++]=d;else if(2047>=d)c[b++]=192|(1984&d)>>>6,c[b++]=128|63&d;else if(55295>=d||d>=57344&&65535>=d)c[b++]=224|(61440&d)>>>12,c[b++]=128|(4032&d)>>>6,c[b++]=128|63&d;else{if(g===h-1)throw new Error("Unpaired surrogate "+a[g]+" (index "+g+")");if(f=a.charCodeAt(++g),55296>d||d>56319||56320>f||f>57343)throw new Error("Unpaired surrogate "+a[g]+" (index "+g+")");e=((1023&d)<<10)+(1023&f)+65536,c[b++]=240|(1835008&e)>>>18,c[b++]=128|(258048&e)>>>12,c[b++]=128|(4032&e)>>>6,c[b++]=128|63&e}++g}return this.write(c),c.length},a.prototype.readUTFChars=a.prototype.readString,a.prototype.writeUTFChars=a.prototype.writeString,a.prototype.readCString=function(){var a,b,c,d;for(a=this._raw,c=a.length,b=this._index;0!==a[b]&&c>b;)++b;return c=b-this._index,c>0?(d=this.readString(c),this.readByte(),d):null},a.prototype.writeCString=function(a){var b;return b=this.writeString(a),this.writeByte(0),++b},a.prototype.prepend=function(a){var b;if(0>=a)throw new RangeError("Invalid number of bytes "+a);return b=new Uint8Array(this.length+a),b.set(this._raw,a),this._index+=a,this.buffer=b.buffer,this},a.prototype.append=function(a){var b;if(0>=a)throw new RangeError("Invalid number of bytes "+a);return b=new Uint8Array(this.length+a),b.set(this._raw,0),this.buffer=b.buffer,this},a.prototype.clip=function(a,b){var c;return null==a&&(a=this._index),null==b&&(b=this.length),0>a&&(a=this.length+a),c=this._buffer.slice(a,b),this._index-=a,this.buffer=c,this},a.prototype.slice=function(a,b){var c;return null==a&&(a=0),null==b&&(b=this.length),c=new e(this._buffer.slice(a,b),this.order)},a.prototype.clone=function(){var a;return a=new e(this._buffer.slice(0),this.order,this.implicitGrowth),a.index=this._index,a},a.prototype.reverse=function(){return Array.prototype.reverse.call(this._raw),this._index=0,this},a.prototype.toArray=function(){return Array.prototype.slice.call(this._raw,0)},a.prototype.toString=function(){var a;return a=this._order===e.BIG_ENDIAN?"big-endian":"little-endian","[ByteBuffer; Order: "+a+"; Length: "+this.length+"; Index: "+this._index+"; Available: "+this.available+"]"},a.prototype.toHex=function(a){return null==a&&(a=" "),Array.prototype.map.call(this._raw,function(a){return("00"+a.toString(16).toUpperCase()).slice(-2)}).join(a)},a.prototype.toASCII=function(a,b,c){var d;return null==a&&(a=" "),null==b&&(b=!0),null==c&&(c="ï¿½"),d=b?" ":"",Array.prototype.map.call(this._raw,function(a){return 32>a||a>126?d+c:d+String.fromCharCode(a)}).join(a)},a}.call(this);